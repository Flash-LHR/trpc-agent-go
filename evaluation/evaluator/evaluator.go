//
// Tencent is pleased to support the open source community by making trpc-agent-go available.
//
// Copyright (C) 2025 Tencent.  All rights reserved.
//
// trpc-agent-go is licensed under the Apache License Version 2.0.
//
//

// Package evaluator provides evaluator for evaluation.
package evaluator

import (
	"context"

	"trpc.group/trpc-go/trpc-agent-go/evaluation/evalset"
	"trpc.group/trpc-go/trpc-agent-go/evaluation/status"
)

// Evaluator defines the contract that an evaluator must satisfy.
type Evaluator interface {
	// Name returns the unique name of evaluator.
	Name() string
	// Description provides a human-readable explanation of the evaluator.
	Description() string
	// Evaluate evaluates the actual invocations against the expected invocations and returns a result.
	Evaluate(ctx context.Context, actuals, expecteds []*evalset.Invocation) (*EvaluationResult, error)
}

// EvaluationResult represents the aggregated outcome of running an evaluator over a set of invocations.
type EvaluationResult struct {
	// OverallScore is the overall score for this evaluation.
	OverallScore float64 `json:"overall_score"`
	// OverallStatus represents pass/fail/not-evaluated for the evaluation run.
	OverallStatus status.EvalStatus `json:"overall_status"`
	// PerInvocationResults contains results for each invocation.
	PerInvocationResults []PerInvocationResult `json:"per_invocation_results"`
}

// PerInvocationResult represents the evaluation result for a single invocation.
type PerInvocationResult struct {
	// ActualInvocation is the invocation generated by the agent.
	ActualInvocation *evalset.Invocation `json:"actual_invocation"`
	// ExpectedInvocation is the reference/golden invocation.
	ExpectedInvocation *evalset.Invocation `json:"expected_invocation"`
	// Score is the evaluator's score for this invocation.
	Score float64 `json:"score"`
	// Status indicates whether the invocation passed, failed or was not evaluated.
	Status status.EvalStatus `json:"status"`
}
